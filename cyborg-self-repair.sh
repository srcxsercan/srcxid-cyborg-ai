#!/bin/bash

echo "ğŸ› ï¸ CYBORG-OS v18: Self-Repair Engine baÅŸlatÄ±lÄ±yor..."
ROOT=$(pwd)

# === 1) Gerekli klasÃ¶rleri doÄŸrula ===
echo "ğŸ“ KlasÃ¶r yapÄ±sÄ± kontrol ediliyor..."
mkdir -p src/cli
mkdir -p src/starship
mkdir -p telemetry/events

# === 2) ModÃ¼l listesi ===
MODULES=(
  "cyborg-about.js"
  "cyborg-nexus.js"
  "cyborg-mesh.js"
  "cyborg-lvm.js"
  "cyborg-compliance.js"
  "cyborg-chain.js"
  "cyborg-quantum.js"
  "cyborg-autopilot.js"
  "cyborg-telemetry-log.js"
  "cyborg-telemetry-report.js"
)

echo "ğŸ” ModÃ¼ller taranÄ±yor..."

for mod in "${MODULES[@]}"; do
  if [ ! -f "src/cli/$mod" ]; then
    echo "âŒ Eksik modÃ¼l bulundu: $mod"
    echo "âœ… BoÅŸ placeholder oluÅŸturuluyor..."
    cat << 'JS' > src/cli/$mod
#!/usr/bin/env node
console.log("âš ï¸ Placeholder: Module missing, auto-generated by Self-Repair Engine.");
JS
    chmod +x src/cli/$mod
  else
    echo "âœ… ModÃ¼l mevcut: $mod"
  fi
done

# === 3) Telemetry test event Ã¼ret ===
echo "ğŸ“¡ Telemetry test event Ã¼retiliyor..."
TEST_EVENT="telemetry/events/$(date +%s)-selftest.json"
echo '{"service":"selftest","timestamp":"now","payload":{"ok":true}}' > $TEST_EVENT

# === 4) Telemetry Ã§alÄ±ÅŸÄ±yor mu? ===
if [ -f "$TEST_EVENT" ]; then
  echo "âœ… Telemetry yazma OK"
else
  echo "âŒ Telemetry yazma HATA"
fi

# === 5) CLI testleri ===
echo "ğŸ§ª CLI testleri yapÄ±lÄ±yor..."

for mod in "${MODULES[@]}"; do
  echo "â¡ï¸ Test: node src/cli/$mod"
  node src/cli/$mod >/dev/null 2>&1
  if [ $? -eq 0 ]; then
    echo "âœ… Ã‡alÄ±ÅŸÄ±yor: $mod"
  else
    echo "âŒ HATA: $mod"
  fi
done

echo "âœ… Self-Repair Engine tamamlandÄ±!"
